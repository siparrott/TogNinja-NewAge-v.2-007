ğŸ—ï¸  **SUPER-SCOPE: Add full sidebar parity to TogNinja CRM Agent**

GOAL  
Our OpenAI-powered agent must handle EVERY feature listed in the left sidebar, not just leads/clients/invoices.  
You will scaffold code, DB tables, tools, and minimal UI hooks so each area is at least CRUD-complete.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”‘ CORE CONSTRAINTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Backend stack = Node + Supabase (service-role key) + Drizzle migrations.  
â€¢ Agent uses Assistants API function calling; every new action == a new tool in `agent/tools`.  
â€¢ Guard-rails: one authority string per major feature, added to `ai_policies.authorities`.  
â€¢ UI is React (Vite) â€“ add placeholder pages/components, but no heavy styling required.  
â€¢ Keep each PR sized: one feature = one migration + one tool file + one React page.  
â€¢ Update `agent/core/tools.ts` and run `agent/update-assistant.js` at the end.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‹ FEATURE CHECKLIST  (implement in this order)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. **Dashboard metrics**  
   â€¢ tables: `dashboard_widgets` (id, studio_id, type, config jsonb)  
   â€¢ tool: `read_dashboard_metrics`  
   â€¢ authority: `READ_DASHBOARD`

2. **Voucher sales**  
   â€¢ table: `voucher_products`, `voucher_sales`  
   â€¢ tools: `create_voucher_product`, `sell_voucher`, `read_voucher_sales`  
   â€¢ authority: `MANAGE_VOUCHERS`

3. **Top-clients segmentation**  
   â€¢ tool: `list_top_clients` (order by lifetime_value desc)  
   â€¢ authority: `READ_TOP_CLIENTS`

4. **Gallery management**  
   â€¢ table: `client_galleries` (id, studio_id, client_id, title, status)  
   â€¢ tools: `create_gallery`, `add_image_to_gallery`, `read_galleries`  
   â€¢ authority: `MANAGE_GALLERIES`

5. **Calendar enhancements**  
   â€¢ extend `photography_sessions` with status + notes  
   â€¢ tools: `reschedule_session`, `list_availability`  
   â€¢ authority: `MANAGE_CALENDAR`

6. **Digital file delivery**  
   â€¢ table: `digital_files` (id, gallery_id, path, type, delivered:boolean)  
   â€¢ tools: `upload_digital_file`, `mark_delivered`  
   â€¢ authority: `MANAGE_FILES`

7. **Manual Blog CMS**  
   â€¢ table: `blog_posts` (id, studio_id, title, slug, body, status)  
   â€¢ tool: `create_blog_post`, `publish_blog_post`  
   â€¢ authority: `MANAGE_BLOG`

8. **Email campaigns**  
   â€¢ table: `email_campaigns`, `campaign_recipients`  
   â€¢ tools: `create_email_campaign`, `send_campaign` (chunked)  
   â€¢ authority: `MANAGE_CAMPAIGNS`

9. **Questionnaires**  
   â€¢ tables: `questionnaires`, `questionnaire_responses`  
   â€¢ tools: `send_questionnaire`, `read_responses`  
   â€¢ authority: `MANAGE_QUESTIONNAIRES`

10. **Reports & analytics**  
    â€¢ endpoint `/api/reports/:name` returns JSON via Supabase RPC  
    â€¢ tool: `generate_report(name, date_range)`  
    â€¢ authority: `READ_REPORTS`

11. **Studio settings**  
    â€¢ page `/admin/settings` that writes to `studio_configs`  
    â€¢ tool: `update_studio_setting(key,value)`  
    â€¢ authority: `MANAGE_SETTINGS`

12. **Template / branding**  
    â€¢ folder `/studio-themes/<studioId>/` for tailwind config + logo path  
    â€¢ tool: `update_brand_asset(type,url)`  
    â€¢ authority: `MANAGE_BRANDING`

13. **Website wizard hooks**  
    â€¢ tool: `crawl_website(url)` â†’ stores metadata in `studio_site_cache`  
    â€¢ authority: `RUN_WIZARD`

14. **Knowledge-base**  
    â€¢ table: `kb_articles` (id, studio_id, title, body, tags)  
    â€¢ tools: `create_article`, `search_kb`  
    â€¢ authority: `MANAGE_KB`

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ› ï¸  IMPLEMENTATION GUIDELINES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ **Migrations** â†’ `drizzle/migrations/<timestamp>_<feature>.sql`  
â€¢ **Tools** â†’ one file per feature in `agent/tools/` exporting Zod-typed tool(s).  
â€¢ **React Pages** â†’ stub under `/src/pages/<Feature>Index.tsx` with simple table & â€œAddâ€ button.  
â€¢ **Policy seeds** â†’ update `supabase/seed/ai_policies.sql` to include new authorities in default conservative mode.  
â€¢ **Unit tests** â†’ Jest file per tool to insert dummy studio row then call handler.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… ACCEPTANCE TEST (run after each feature)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. `npm run migrate` â†’ no errors  
2. `npm run agent:test` â†’ assistant lists the new tool in `assistant.tools`  
3. Via Repl AI chat:  
   * â€œcreate a voucher product â€˜Gold Giftâ€™ â‚¬200â€ â†’ returns voucher id  
   * â€œsell voucher â€˜Gold Giftâ€™ to Matt Pantlingâ€ â†’ returns sale record  
   * â€œlist top clientsâ€ â†’ returns table  
   * etc.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„  CYCLIC WORKFLOW  (per feature)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Generate SQL + tool skeleton.  
2. Run migration locally, adjust types.  
3. Add to `toolRegistry`, run `agent/update-assistant.js`.  
4. Add minimal React page with fetch from `/api/<feature>`.  
5. Run Jest test.  
6. Commit & push.

Please start with **Voucher sales (Feature 2)**, finish the full cycle, then continue in the order listed.  Answer â€œReadyâ€ when scaffolding for Feature 2 is complete and tests pass.
